<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Cache Busting Test - ColorStack</title>
    
    <!-- Test external resources with versioning -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries&v=2.1.2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap&amp;v=2.1.2" rel="stylesheet"/>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0A;
            color: #E0E0E0;
            padding: 2rem;
        }
        .test-card {
            background-color: #1A1A1A;
            border: 1px solid #2A2A2A;
            border-radius: 12px;
            padding: 2rem;
            margin: 1rem 0;
        }
        .success { color: #10B981; }
        .error { color: #EF4444; }
        .info { color: #3B82F6; }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">üß™ Cache Busting Test</h1>
        
        <div class="test-card">
            <h2 class="text-xl font-semibold mb-4">Version Information</h2>
            <div id="version-info">
                <p class="info">Loading version information...</p>
            </div>
        </div>
        
        <div class="test-card">
            <h2 class="text-xl font-semibold mb-4">Resource Loading Test</h2>
            <div id="resource-test">
                <p class="info">Testing resource loading...</p>
            </div>
        </div>
        
        <div class="test-card">
            <h2 class="text-xl font-semibold mb-4">Service Worker Test</h2>
            <div id="sw-test">
                <p class="info">Testing service worker...</p>
            </div>
        </div>
        
        <div class="test-card">
            <h2 class="text-xl font-semibold mb-4">Cache Status</h2>
            <div id="cache-status">
                <p class="info">Checking cache status...</p>
            </div>
        </div>
    </div>

    <script>
        // Test version loading
        async function testVersionLoading() {
            try {
                const response = await fetch('js/version.js?v=2.1.2');
                if (response.ok) {
                    document.getElementById('version-info').innerHTML = 
                        '<p class="success">‚úÖ Version.js loaded successfully</p>';
                } else {
                    document.getElementById('version-info').innerHTML = 
                        '<p class="error">‚ùå Failed to load version.js</p>';
                }
            } catch (error) {
                document.getElementById('version-info').innerHTML = 
                    '<p class="error">‚ùå Error loading version.js: ' + error.message + '</p>';
            }
        }

        // Test resource loading
        async function testResourceLoading() {
            const resources = [
                'js/main.js?v=2.1.2',
                'js/ui.js?v=2.1.2',
                'js/image_processor.js?v=2.1.2',
                'Logo.svg?v=2.1.2'
            ];
            
            let results = [];
            for (const resource of resources) {
                try {
                    const response = await fetch(resource);
                    if (response.ok) {
                        results.push(`‚úÖ ${resource}`);
                    } else {
                        results.push(`‚ùå ${resource} (${response.status})`);
                    }
                } catch (error) {
                    results.push(`‚ùå ${resource} (${error.message})`);
                }
            }
            
            document.getElementById('resource-test').innerHTML = 
                results.map(r => `<p class="${r.includes('‚úÖ') ? 'success' : 'error'}">${r}</p>`).join('');
        }

        // Test service worker
        async function testServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        document.getElementById('sw-test').innerHTML = 
                            '<p class="success">‚úÖ Service Worker registered</p>' +
                            '<p class="info">Scope: ' + registration.scope + '</p>';
                    } else {
                        document.getElementById('sw-test').innerHTML = 
                            '<p class="error">‚ùå No Service Worker registered</p>';
                    }
                } catch (error) {
                    document.getElementById('sw-test').innerHTML = 
                        '<p class="error">‚ùå Service Worker error: ' + error.message + '</p>';
                }
            } else {
                document.getElementById('sw-test').innerHTML = 
                    '<p class="error">‚ùå Service Worker not supported</p>';
            }
        }

        // Test cache status
        async function testCacheStatus() {
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    const colorstackCaches = cacheNames.filter(name => name.includes('colorstack'));
                    
                    if (colorstackCaches.length > 0) {
                        document.getElementById('cache-status').innerHTML = 
                            '<p class="success">‚úÖ Found ColorStack caches:</p>' +
                            colorstackCaches.map(cache => `<p class="info">‚Ä¢ ${cache}</p>`).join('');
                    } else {
                        document.getElementById('cache-status').innerHTML = 
                            '<p class="error">‚ùå No ColorStack caches found</p>';
                    }
                } catch (error) {
                    document.getElementById('cache-status').innerHTML = 
                        '<p class="error">‚ùå Cache error: ' + error.message + '</p>';
                }
            } else {
                document.getElementById('cache-status').innerHTML = 
                    '<p class="error">‚ùå Cache API not supported</p>';
            }
        }

        // Run all tests
        window.addEventListener('load', async () => {
            await testVersionLoading();
            await testResourceLoading();
            await testServiceWorker();
            await testCacheStatus();
        });
    </script>
</body>
</html> 